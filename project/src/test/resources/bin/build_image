#!/bin/sh

set -eu

if [ -z "$GITHUB_ACTOR" ] ||\
    [ -z "$GITHUB_TOKEN" ] then
  printf "You need to set the following environment variables:\n\t%s\n\t%s\n" \
    "GITHUB_ACTOR" \
    "GITHUB_TOKEN" \
  exit 1
fi

image_tag="ghcr.io/i-on-project/core:latest"

docker build -f ./project/res/dockerfile_deploy_instance -t "${image_tag}" .
echo $GITHUB_TOKEN | docker login ghcr.io -u $GITHUB_ACTOR --password-stdin
docker push "${image_tag}"