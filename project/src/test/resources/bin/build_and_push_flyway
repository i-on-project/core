#!/bin/sh

set -eu

flyway_image_tag="ghcr.io/i-on-project/flyway-postgres:latest"

docker build -f ./project/res/dockerfile_flyway \
    -t "${flyway_image_tag}" .

if [ -z "${GITHUB_ACTOR:-}" ] ||\
    [ -z "${GITHUB_TOKEN:-}" ]; then
  printf "Set the GITHUB_ACTOR and GITHUB_TOKEN environment variables to push the image to the registry!\n"
  exit 0
fi

echo "$GITHUB_TOKEN" | docker login ghcr.io -u "$GITHUB_ACTOR" --password-stdin

docker push "${flyway_image_tag}"
