-- This script inserts the essencial DB values for the server to function properly
-- The occasions to run this script are:
--   - on a freshly created schema;
--   - on a maintained database which needs to be updated (after schema migration)
-- The insert statements will ignore conflicting rows.

INSERT INTO dbo.Language(name) VALUES
('pt-PT'),
('en-US'),
('en-GB'),
('ab'),
('aa'),
('af'),
('ak'),
('sq'),
('am'),
('ar'),
('an'),
('hy'),
('as'),
('av'),
('ae'),
('ay'),
('az'),
('bm'),
('ba'),
('eu'),
('be'),
('bn'),
('bh'),
('bi'),
('bs'),
('br'),
('bg'),
('my'),
('ca'),
('ch'),
('ce'),
('ny'),
('zh'),
('zh-Hans'),
('zh-Hant'),
('cv'),
('kw'),
('co'),
('cr'),
('hr'),
('cs'),
('da'),
('dv'),
('nl'),
('dz'),
('eo'),
('et'),
('ee'),
('fo'),
('fj'),
('fi'),
('fr'),
('ff'),
('gl'),
('gd'),
('gv'),
('ka'),
('de'),
('el'),
('kl'),
('gn'),
('gu'),
('ht'),
('ha'),
('he'),
('hz'),
('hi'),
('ho'),
('hu'),
('is'),
('io'),
('ig'),
('id'),
('in'),
('ia'),
('ie'),
('iu'),
('ik'),
('ga'),
('it'),
('ja'),
('jv'),
('kn'),
('kr'),
('ks'),
('kk'),
('km'),
('ki'),
('rw'),
('rn'),
('ky'),
('kv'),
('kg'),
('ko'),
('ku'),
('kj'),
('lo'),
('la'),
('lv'),
('li'),
('ln'),
('lt'),
('lu'),
('lg'),
('lb'),
('mk'),
('mg'),
('ms'),
('ml'),
('mt'),
('mi'),
('mr'),
('mh'),
('mo'),
('mn'),
('na'),
('nv'),
('ng'),
('nd'),
('ne'),
('no'),
('nb'),
('nn'),
('oc'),
('oj'),
('cu'),
('or'),
('om'),
('os'),
('pi'),
('ps'),
('fa'),
('pl'),
('pa'),
('qu'),
('rm'),
('ro'),
('ru'),
('se'),
('sm'),
('sg'),
('sa'),
('sr'),
('sh'),
('st'),
('tn'),
('sn'),
('ii'),
('sd'),
('si'),
('sk'),
('sl'),
('so'),
('nr'),
('es'),
('su'),
('sw'),
('ss'),
('sv'),
('tl'),
('ty'),
('tg'),
('ta'),
('tt'),
('te'),
('th'),
('bo'),
('ti'),
('to'),
('ts'),
('tr'),
('tk'),
('tw'),
('ug'),
('uk'),
('ur'),
('uz'),
('ve'),
('vi'),
('vo'),
('wa'),
('cy'),
('wo'),
('fy'),
('xh'),
('yi'),
('ji'),
('yo'),
('za')
ON CONFLICT DO NOTHING;

INSERT INTO dbo.ICalendarDataType(name) VALUES
('BINARY'),
('BOOLEAN'),
('CAL-ADDRESS'),
('DATE'),
('DATE-TIME'),
('DURATION')
ON CONFLICT DO NOTHING;

INSERT INTO dbo.Category OVERRIDING SYSTEM VALUE VALUES(1) ON CONFLICT DO NOTHING; -- 1
INSERT INTO dbo.Category OVERRIDING SYSTEM VALUE VALUES(2) ON CONFLICT DO NOTHING; -- 2
INSERT INTO dbo.Category OVERRIDING SYSTEM VALUE VALUES(3) ON CONFLICT DO NOTHING; -- 3
INSERT INTO dbo.Category OVERRIDING SYSTEM VALUE VALUES(4) ON CONFLICT DO NOTHING; -- 4
INSERT INTO dbo.Category OVERRIDING SYSTEM VALUE VALUES(5) ON CONFLICT DO NOTHING; -- 5
INSERT INTO dbo.Category OVERRIDING SYSTEM VALUE VALUES(6) ON CONFLICT DO NOTHING; -- 6

INSERT INTO dbo.CategoryLanguage(category, name, language) VALUES
(1, 'Exame',       1),
(2, 'Aula',        1),
(3, 'Laborat√≥rio', 1),
(4, 'Aviso',       1),
(5, 'Entrega',     1),
(6, 'Teste',       1),
(1, 'Exam',        2),
(1, 'Exam',        3),
(2, 'Lecture',     2),
(2, 'Lecture',     3),
(3, 'Laboratory',  2),
(3, 'Laboratory',  3),
(4, 'Warning',     3),
(4, 'Warning',     2),
(5, 'Deadline',    2),
(5, 'Deadline',    3),
(6, 'Test',        2),
(6, 'Test',        3)
ON CONFLICT DO NOTHING;


-- AM
-- read:calendar scope only used by derived tokens
INSERT INTO dbo.scopes (scope) VALUES
('urn:org:ionproject:scopes:api:read'),
('urn:org:ionproject:scopes:api:write'),
('urn:org:ionproject:scopes:token:issue'),
('urn:org:ionproject:scopes:api:read_restricted'),
('urn:org:ionproject:scopes:api:revoke'),
('urn:org:ionproject:scopes:api:read:calendar')
ON CONFLICT DO NOTHING;

/*
* Don't use wildcards in the paths
* e.g. /v0/courses which a user may have permission to access
* can be tricked into accepting a request to a resource he is not allowed.
* e.g. GET "/v0/courses/../programmes"
* if the code accepts anything towards "/v0/courses*"
*
* IMPORTANT NOTE: WHEN ADDING NEW ENDPOINT URI'S BE CAREFUL NOT TO FALL IN THE "WILDCARD" OF AN ALREADY EXISTING ENDPOINT, 
* IF THAT HAPPENS AND THE ENDPOINT WITH WILDCARD IS AUTHORIZED TO SOME SCOPE, THE PERSON CAN USE THE SAME SCOPE TO ACCESS THE NEW ENDPOINT
*/
INSERT INTO dbo.policies(scope_id, method, version, resource) VALUES
(1, 'GET', 'v0', 'getHome'),
(1, 'GET', 'v0', 'search'),
(3, 'POST', '*', 'issueToken'),
(2, 'POST', '*', 'revokeToken'),
(3, 'POST', '*', 'revokeToken'),
(4, 'POST', '*', 'revokeToken'),
(5, 'POST', '*', 'revokeToken'),
(1, 'GET', 'v0', 'getProgramme'),
(1, 'GET', 'v0', 'getProgrammes'),
(4, 'GET', 'v0', 'getProgramme'), --Testing read restricted scope
(4, 'GET', 'v0', 'getProgrammes'), --Testing read restricted scope
(1, 'GET', 'v0', 'getOffer'),
(1, 'GET', 'v0', 'importClassCalendar'),
(1, 'GET', 'v0', 'importClassSectionCalendar'),
(1, 'GET', 'v0', 'getCourses'),
(1, 'GET', 'v0', 'getCourse'),
(1, 'GET', 'v0', 'getClasses'),
(1, 'GET', 'v0', 'getClass'),
(1, 'GET', 'v0', 'getClassSection'),
(1, 'GET', 'v0', 'getCalendarClass'),
(1, 'GET', 'v0', 'getCalendarClassSection'),
(6, 'GET', 'v0', 'getCalendarClass'),           -- used by derived tokens to read calendars
(6, 'GET', 'v0', 'getCalendarClassSection'),
(1, 'GET', 'v0', 'getComponentClass'),
(1, 'GET', 'v0', 'getComponentClassSection'),
(1, 'GET', 'v0', 'getCalendarTerms'),
(1, 'GET', 'v0', 'getCalendarTerm'),
(2, 'PUT', 'v0', 'insertClassSectionFaculty'),
(2, 'PUT', 'v0', 'insertClassSectionEvents'),
(2, 'PUT', 'v0', 'insertCalendarTerm'),
(1, 'GET,POST', '*', 'error'),
(2, 'GET,POST', '*', 'error'),
(3, 'GET,POST', '*', 'error'),
(4, 'GET,POST', '*', 'error')
ON CONFLICT DO NOTHING;